{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "array",
  "items": { "$ref": "#/definitions/showcase" },

  "definitions": {
    "baseProperties": {
      "properties": {
        "name": { "type": "string", "default": "無名の作品" },
        "type": { "$ref": "#/definitions/typeEnum" },
        "flags": { "$ref": "#/definitions/flags" }
      },
      "required": ["name", "type"],
      "allOf": [
        {
          "if": {
            "properties": { "type": { "const": "embed" } }
          },
          "then": {
            "$ref": "#/definitions/embedShowcase"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "image" } }
          },
          "then": {
            "$ref": "#/definitions/imageShowcase"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "model" } }
          },
          "then": {
            "$ref": "#/definitions/modelShowcase"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "scratch" } }
          },
          "then": {
            "$ref": "#/definitions/scratchShowcase"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "link" } }
          },
          "then": {
            "$ref": "#/definitions/linkShowcase"
          }
        },
        {
          "if": {
            "properties": { "type": { "const": "grouped" } }
          },
          "then": {
            "$ref": "#/definitions/groupedShowcase"
          }
        }
      ]
    },

    "showcase": {
      "type": "object",
      "properties": {
        "icon": { "$ref": "#/definitions/iconEnum" },
        "thumbnailSrc": { "type": "string", "default": "./showcase/default_thumbnail.webp" },
        "tags": { "$ref": "#/definitions/tags" }
      },
      "$ref": "#/definitions/baseProperties",
      "required": ["icon", "thumbnailSrc"]
    },

    "typeEnum": {
      "enum": ["embed", "image", "model", "scratch", "link", "grouped"]
    },
    "iconEnum": {
      "anyOf": [
        {
          "enum": ["media", "model", "game"]
        },
        {
          "type": "string"
        }
      ]
    },

    "embedShowcase": {
      "properties": {
        "src": { "type": "string" }
      }
    },
    "imageShowcase": {
      "properties": {
        "imageSrc": { "type": "string" }
      }
    },
    "modelShowcase": {
      "properties": {
        "modelSrc": { "type": "string", "default": "./showcase/default_model.glb" },
        "clearColor": {
          "type": "string",
          "pattern": "0x[0-9A-Fa-f]{6}"
        }
      },
      "required": ["modelSrc"]
    },
    "scratchShowcase": {
      "properties": {
        "projectId": { "type": "number" },
        "turbowarp": { "type": "boolean", "default": false }
      },
      "required": ["projectId"]
    },
    "linkShowcase": {
      "properties": {
        "href": { "type": "string", "default": "https://google.com" }
      },
      "required": ["href"]
    },
    "groupedShowcase": {
      "properties": {
        "children": { "type": "array", "items": { "$ref": "#/definitions/showcase" } }
      }
    },

    "flags": {
      "type": "array",
      "items": {
        "enum": ["external", "keyboard_required"]
      }
    },

    "tags": {
      "type": "array",
      "items": {
        "anyOf": [
          {
            "enum": ["festival_2025"]
          },
          {
            "type": "string"
          }
        ]
      }
    }
  }
}
